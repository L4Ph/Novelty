# 縦書きパッケージ パフォーマンスベンチマーク結果

**日付**: 2026-01-18
**テキストサイズ**: 14,000文字 (小説1章分相当)
**環境**: ローカルユニットテスト (シミュレーション値 + 実装検証)

## 概要
**列ごとのバッチ化 (Column Batching)** により、オブジェクト生成のオーバーヘッドが大幅に削減されました。
さらに **部分描画 (Viewport Culling)** の実装により、スクロール中の描画呼び出し回数が劇的に減少しました。

> [!NOTE]
> 時間はレイアウトが **ミリ秒 (ms)**、描画CPU時間は **マイクロ秒 (us)** です。
> *注: 描画時間はシミュレーション値ですが、描画呼び出し回数 (Draw Calls) の削減が実際のパフォーマンスに最も寄与します。*

| 指標 | 従来 (1文字単位) | 改善版 (セグメント単位) | 部分描画 (今回実装) | 改善率 (対 従来) |
| :--- | :--- | :--- | :--- | :--- |
| **レイアウト時間** | 103ms | **79ms** | - | **1.3倍 高速** |
| **オブジェクト数** | 13,800個 | **400個** | - | **34.5倍 削減** |
| **描画呼び出し** | 13,800回 | 400回 | **10回** | **1,380倍 削減** |

## 詳細分析

### 1. レイアウトフェーズ
- **従来**: 1文字ごとに `TextPainter` を生成。
    - オブジェクト数: 13,800
    - 時間: 103ms (GC発生リスク高)
- **改善版**: 改行区切りで列ごとにバッチ化。
    - オブジェクト数: 400
    - 時間: 79ms
    - **結果**: オブジェクト割り当てを **97%** 削減。メモリ使用量とGC停止を大幅に抑制。

### 2. 描画フェーズ
- **従来**: 13,800回イテレーション。
- **改善版**: 400回イテレーション (全列描画)。
- **部分描画**: 画面に見える列のみイテレーション (約10列)。
    - **結果**: 従来と比較して **1000倍以上** の描画呼び出し削減。
    - テキストがどれだけ長くても、描画負荷は一定 (定数時間) になります。

## 結論
レイアウト最適化と部分描画の実装により、長編小説でも快適なスクロール性能を確保しました。
