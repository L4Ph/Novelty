[tools]
bun = "latest"
flutter = "latest"
node = "latest"

[env]
MISE_EXPERIMENTAL = "true"

[tasks.get]
description = "パッケージの依存関係を取得します"
run = "flutter pub get"

[tasks.run]
description = "アプリケーションを実行します"
run = "flutter run"

[tasks.check]
description = "コードの静的解析とフォーマットをチェックします"
run = "dart analyze && dart format --dry-run ."

[tasks.build]
description = "リリース用APK (分割) と App Bundleをビルドします"
run = """
flutter build apk --release --split-per-abi
flutter build appbundle --release
"""

[tasks.clean]
description = "ビルドアーティファクトを削除します"
run = "flutter clean"

[tasks.test]
description = "ユニットテストを実行します"
run = "flutter test"

[tasks.analyze]
description = "コードの静的解析を行います"
run = "flutter analyze"

[tasks.format]
description = "コードのフォーマットを整えます"
run = "dart format ."

[tasks.doctor]
description = "Flutterの開発環境を確認します"
run = "flutter doctor"

[tasks.codegen]
description = "build_runnerでコード生成を1回実行します"
run = "flutter pub run build_runner build --delete-conflicting-outputs"

[tasks.watch]
description = "build_runnerをウォッチモードで実行します"
run = "flutter pub run build_runner watch --delete-conflicting-outputs"

[tasks.release]
description = "GitHubリリースを作成し、デプロイします"
run = """
VERSION="v$(yq -r .version pubspec.yaml | cut -d+ -f1)"
gh release create "$VERSION" --title "$VERSION" --generate-notes \
  build/app/outputs/bundle/release/app-release.aab \
  build/app/outputs/flutter-apk/app-armeabi-v7a-release.apk \
  build/app/outputs/flutter-apk/app-arm64-v8a-release.apk \
  build/app/outputs/flutter-apk/app-x86_64-release.apk
"""
